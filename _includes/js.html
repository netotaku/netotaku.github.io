
<script type="text/html" id="paginator">
  <ul class="pagination">
    <li><a href="#">&laquo;</a></li>
      <% for(var i = 1; i <= pages; i++) { %>
        <% if(i==cursor) { %>
          <li class="active"><a href="#"><%=i%></a></li>
        <% } else { %>
          <li><a href="#"><%=i%></a></li>
        <% } %>
      <% } %>
    <li><a href="#">&raquo;</a></li>
  </ul>
</script>

<script type="text/html" id="commits">
  <ul class="paginate updates">
    <% for(var i = 0; i < commits.length; i++) { %>
      <li>
        <a class="commit" href="<%=commits[i].html_url %>"><%=commits[i].sha.substring(0,6) %></a> <%=commits[i].commit.message %>
      </li>
    <% } %>
  </ul>
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4dbf29307cc266c2" async="async"></script>
<script src="/vendor/twitter/post-fetcher.js"></script>
<script src="/vendor/jquery-timeago/jquery.timeago.js"></script>
<script>

  (function($){
    "use strict";

    var $burger = $('.burger'),
        $window = $(window),
        $body = $(document.body);

    $('.down-arrow').on('click', function(e){
      e.preventDefault();
      $("html, body").animate({ scrollTop: $('[role=main]').offset().top }, 450);
    });

    $('.action').on('click', function(e){
      e.preventDefault();
      $($(this).data('toggle')).toggleClass('opened');
    });

    if($('#tweet').length > 0){
      twitterFetcher.fetch({
        "id": '320201997074710529',
        "domId": 'tweet',
        "maxTweets": 1,
        "enableLinks": true
      });
    }


    $.getJSON('https://api.github.com/repos/netotaku/netotaku.github.io/commits', function(data){

      var tmp = _.template($('#commits').html());

      $('#updates').replaceWith(tmp({
        commits: data
      }));

      $(".paginate").each(function(){
        new paginator($(this));
      });

      ///

      var commit = data[0].commit;
      $('.last-updated').html('Last updated <a href="' + commit.url + '" target="_blank">' + $.timeago(commit.author.date) + '</a>');
    });


    function scrollTest{
      return $window.scrollTop() > $burger.height();
    }

    $window.on('scroll load touchend', function(){
      if(scrollTest()){
        $body.addClass('scrolling');
      } else {
        $body.removeClass('scrolling');
      }
    });

    ////////

    var paginator = function($el){
      var $lis = $el.children('li'),
          lisPerPage = 6,
          cursor = 0,
          totalPages = Math.ceil( $lis.length / lisPerPage ),
          turn = function(i){
            if(i < totalPages && i > -1){
              cursor = i;
              var start = cursor*lisPerPage,
                  end = start+lisPerPage;
              $lis.hide().slice(start,end).show();
              $pagination.removeClass('active').eq(cursor+1).addClass('active');
            }
          };

          // console.log(lisPerPage < $lis.length);

      if(lisPerPage < $lis.length){

        var tmp = _.template($('#paginator').html());

        var $pagination = $(tmp({
          pages: totalPages,
          cursor: cursor
        })).insertAfter($el).find('li').on('click', function(e){
          e.preventDefault();
          var $this = $(this),
              i = $this.index()-1;
          if($this.is(':first-child')){
            i = cursor-1;
          } else if($this.is(':last-child')){
            i = cursor+1;
          }
          turn(i);
        });
        turn(cursor);
      }
    }

    ////////




  })(jQuery);

  /////

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-59040010-1', 'auto');
  ga('send', 'pageview');
</script>
